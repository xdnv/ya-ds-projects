# Проект: Прогноз оттока клиентов банка

*Цель: спрогнозировать, уйдёт клиент из банка в ближайшее время или нет.*
Заказчиком предоставлены исторические данные о поведении клиентов и расторжении договоров с банком.
Постройте модель с предельно большим значением F1-меры > 0.59.
Дополнительно измеряйте AUC-ROC.

*Учебная задача: научиться...*
1. кодировать классы с помощью One-hot и Ordered подходов;
2. балансировать классы;
3. использовать градиентный бустинг;
4. использовать метрики качества F1 и AUR-ROC;
5. выделять и использовать тестовую выборку.

## Программа исследования
- Данные загружены и предобработаны;
- проведено кодирование классов
- обучены модели машинного обучения без учёта дисбаланса классов (логрег, решающее дерево, GridSearch с решающим деревом);
- проведена балансировка целевых значений с помощью встроенной балансировки, увеличения и уменьшения объёма классов.
- обучены модели машинного обучения со скорректированным дисбалансом классов (логрег, решающее дерево, случайный лес)
- выбрана и протестирована оптимальная модель;

## Результаты
получены ответы на вопросы:
1. *Загрузка и исследование данных*
- Удалены колонки RowNumber, CustomerId, Surname и пропуски в колонке Tenure (9% датасета)

2. *Предобработка данных*
Анализ гистограмм и структурных диаграмм по баласнсу ушедших и оставшихся клиентов показал следующее:
	- Практически половина клиентов банка имеет нулевой баланс.
	- Ушедшие клиенты на треть реже имели нулевой баланс, медианное и максимальное значения баланса у них выше, чем у оставшихся. Можно говорить о наличии склонности к уходу активных клиентов с деньгами.
	- Обе выборки демонстрируют распределение, близкое к нормальному и отсутсвие выбросов (нулевой баланс за выброс не считаем).
	- Во время анализа возникла гипотеза о влиянии факта наличия кредитной карты на нулевой баланс: какие-то клиенты могут "жить в минус" по кредитке и регулярно погашать задолженности. Последующий анализ клиентов с кредитными картами и без оных не даёт оснований принимать в расчёт факт наличия кредитных карт. Либо кредитки не учитываются в оценке баланса (т.к. он всегда больше нуля), либо они увеличивают баланс на размер кредитного лимита.
	-  Данные по предполагаемой зарплате похожи на "белый шум" и существенной аналитической ценности в рамках проекта не представляют. При столь равномерном распределении значений непонятен профиль клиентов и специализация банка.

3. *Оценка моделей без балансировки классов*
- Проведена оценка сбалансированности таргетов: выявлен большой перекос в данных в сторону 0-значений (80%), потребуется балансировка классов.
- Проведено кодирование категориальных переменных по методам OHE и OE.
- Данные разделены на тренировочную, тестовую и валидационные выборки в пропорции 3:1:1 с сохранением баланса классов.
- Проведено масштабирование числовых параметров

Без балансировки классов оценены параметры следующих моделей:
- Логистической регрессии с солвером 'liblinear'.
- "Деревьев решений" по датасетам с "горизонтально" (OHE) и рангово (OE) закодированными строковыми класификаторами. Модели по датасету OHE показывают чуть лучшие результаты.
- С помощью GridSearch подобраны оптимальные гиперпараметры "Деревьев решений", динамика по OE/OHE датасетам сохраняется.
- Выйти на целевое значение F1-меры на данном шаге предсказуемо не удалось из-за дисбаланса классов: модели дают много ложноотрицательных ответов.

4. *Исследование моделей с балансировкой классов:*
- Логистическая регрессия
- Дерево решений без подбора гиперпараметров
- Дерево решений с подобранными оптимальными гиперпараметрами
- Случайный лес без подбора гиперпараметров
- Случайный лес с подбором гиперпараметров
- Выбрана наилучшая модель (случайный лес с оптимальными гиперпараметрами)

Проведено исследование наилучшей модели на датасетах с увеличением и уменьшением целевых классов выборки

5. *Метрики по модели, обученной на комбинированном наборе данных получаются наилучшими из всех обработанных моделей:*
- F1-мера: 0.643 при целевой 0.59
- AUC-ROC: 0.877
- Данная модель принимается как финальная по проекту.

## Стек и применённые подходы
* pandas, seaborn, matplotlib, sklearn, plotly